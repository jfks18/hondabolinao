# Render Blueprint for Honda 3S Dealership
# This file enables one-click deployment to Render.com

services:
  # WebSocket Server Service
  - type: web
    name: honda-websocket-server
    env: node
    plan: free
    # Install all dependencies (use CI for reproducible installs) and then start the server
    buildCommand: npm ci --production || npm install
    startCommand: node websocket-server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: RATE_LIMIT_PER_MINUTE
        value: 60
      - key: MAX_CONNECTIONS
        value: 100
      - key: ENABLE_RATE_LIMITING
        # Render stores env values as strings; websocket-server.js expects 'true'/'false' strings
        value: "true"
      - key: ENABLE_AUTH
        value: "false"
      - key: ALLOWED_ORIGINS
        value: "https://honda-dealership-frontend.onrender.com,https://hondabolinao-20dg.onrender.com"
      - key: JSON_DB_PATH
        value: "/tmp/inventory.json"

  # Next.js Frontend Service  
  - type: web
    name: honda-dealership-frontend
    env: node
    plan: free
    buildCommand: npm run build
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_ENABLE_REAL_TIME
        value: "true"
      - key: NEXT_PUBLIC_RATE_LIMIT_PER_MINUTE
        value: 60
      - key: NEXT_PUBLIC_MAX_CONNECTIONS
        value: 100
      - key: NEXT_PUBLIC_ENABLE_ENCRYPTION
        value: "false"
      - key: NEXT_PUBLIC_ENABLE_SIGNATURE_VALIDATION
        value: "false"
      - key: NEXT_PUBLIC_AUTH_ENABLED
        value: "false"
      - key: NEXT_PUBLIC_CACHE_DURATION
        value: 300000
      - key: NEXT_PUBLIC_HEARTBEAT_INTERVAL
        value: 30000
      - key: NEXT_PUBLIC_WSS_URL
        value: wss://honda-websocket-server.onrender.com
      - key: NEXT_PUBLIC_API_BASE
        value: https://honda-websocket-server.onrender.com